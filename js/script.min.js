var pipeApp=angular.module("pipeApp",[]); pipeApp.controller("pipeController",["$scope","pipeFactory",function(a,e){a.loading=!1;a.pipes=[{title:"Business News Feeds",pipeId:"DqsF_ZG72xGLbes9l7okhQ"},{title:"Aggregated News Alerts",pipeId:"fELaGmGz2xGtBTC3qe5lkA"},{title:"Broad News Search",pipeId:"uLI4XFfU3BGd3kpin0artA"}];if(localStorage&&localStorage.pipeAppPipes){var b=JSON.parse(localStorage.getItem("pipeAppPipes"));b&&1<b.length&&(a.pipes=b)}a.$watch("pipeId",function(a,d){a!==d&&e.pipeNotify.toggle(!1)});a.$watch("pipes.length",function(c, d){c!==d&&localStorage&&localStorage.setItem("pipeAppPipes",JSON.stringify(a.pipes))});a.resolvePipe=function(c,d){(13===c.keyCode||"Enter"===c.key||!1===d)&&a.pipeId&&a.loadPipe(a.pipeId,!0)};a.removePipe=function(c,d){d&&$(d.target).parent("li").hasClass("active")&&(a.items=[]);a.pipes.splice(c,1)};a.loadPipe=function(c,d){!0!==d&&(a.loading=!0);e.fetchPipe(c).then(function(b){e.pipeNotify.toggle(!1);_.some(a.pipes,function(a){return a.pipeId===c})||(a.pipes.push({title:b.data.value.title,pipeId:a.pipeId}), a.pipes=_.sortBy(a.pipes,function(a){return a.title}));!0!==d&&(b.data.value.items=b.data.value.items.slice(0,10),angular.forEach(b.data.value.items,function(a){a.description=a.description.replace(/<\/?[^>]+>/gi,"").replace(/[&\/\\#,+()$~%.'":*?<>{}]/g,"")}),a.items=b.data.value.items,a.loading=!1,$("#pipeFeeds li").removeClass("active"),$('#pipeFeeds li:contains("'+b.data.value.title+'")').addClass("active"))},function(){a.loading=!1})};a.viewItem=function(a){window.open(a,"_blank")};a.loadPipe("DqsF_ZG72xGLbes9l7okhQ")}]); pipeApp.factory("pipeFactory",["$http","$timeout",function(a,e){var b={fetchPipe:function(c){return a.jsonp("http://pipes.yahoo.com/pipes/pipe.run?_id="+c+"&_render=json&_callback=JSON_CALLBACK").success(function(a){return a}).error(function(){b.pipeNotify.toggle(!0);return!1})},pipeNotify:{timeout:null,toggle:function(a){!1===a?($("#pipeNotify").removeClass("active"),this.timeout&&e.cancel(this.timeout),this.timeout=null):($("#pipeNotify").addClass("active"),this.timeout=e(function(){b.pipeNotify.toggle(!1)}, 5E3))}}};return b}]);